SELECT npq21 as 客户代码,oma16 as 出库单号,npp02 as 账款日期, oma01 as 账款单号,case when npp00='2' then '产品销售' when npp00='3' then '收款' else ' ' end as 单据类别, case when npq06=1 then sum(npq07f) else NULL end as 本期借方,case when npq06=2 then sum(npq07f) else NULL end as 本期贷方 FROM npp_file inner join npq_file on npp01=npq01 inner join aag_file on npq03=aag01  left  join oma_file on npp01=oma01 where npq03 = aag01 AND npq21 ='109010' AND npq03 ='1131' AND month(npp02)=11 AND npp02>=to_date('2015-11-01','yyyy-mm-dd') AND npp02<to_date('2015-12-01','yyyy-mm-dd') GROUP BY npq21,oma01,npp02,oma16,npp00,npq06 order by npp02